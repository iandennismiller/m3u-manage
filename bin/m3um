#!/usr/bin/env python

import sys
sys.path.insert(0, '.')

import click
from m3u_manage.filesystem import regularize, analyze, decide, gather, tag
from m3u_manage.playlist import mesh, curate, repeat, append_video, insert_video, delete_video, get_video, get_summary

@click.group()
def cli():
    pass

@click.command('analyze', short_help='Analyze directory for keywords.')
@click.option('--config', '-c', help='Config file containing tags.')
@click.argument('directory', required=True)
def do_analyze(directory, config):
    analyze(directory, config)

@click.command('curate', short_help='Automatically curate videos into playlists.')
@click.option('--config', required=True, help='Curation configuration filename.')
def do_curate(config):
    curate(config)

@click.command('mesh', short_help='Combine playlists by interleaving items.')
@click.option('--outfile', '-o', required=True, help='New playlist file to create.')
@click.argument('filenames', nargs=-1, required=True)
def do_mesh(filenames, outfile):
    mesh(filenames, outfile)

# decide PATH DEST1 DEST2
@click.command('decide', short_help='Perform sorting decisions about videos.')
@click.argument('path', required=True)
@click.argument('dest1', required=True)
@click.argument('dest2', required=True)
def do_decide(path, dest1, dest2):
    decide(path, dest1, dest2)

@click.command('regularize', short_help='Regularize filenames in a directory.')
@click.argument('directory', required=True)
def do_regularize(directory):
    regularize(directory)

@click.command('gather', short_help='Recursively move from DIRECTORY into DESTINATION, flattening directory hierarchy.')
@click.argument('directory', required=True)
@click.argument('destination', required=True)
def do_gather(directory, destination):
    gather(directory, destination)

@click.command('tag', short_help='Tag files in directory.')
@click.option('--config', '-c', help='Config file containing tags.')
@click.argument('directory', required=True)
def do_tag(directory, config):
    tag(directory, config)

@click.command('repeat', short_help='Create playlist consisting of video repeated.')
@click.argument('output_m3u', required=True)
@click.argument('video', required=True)
@click.argument('times', required=True)
def do_repeat(output_m3u, video, times):
    repeat(output_m3u, video, times)

@click.command('append', short_help='Update m3u by appending video to end.')
@click.argument('input_m3u', required=True)
@click.argument('video', required=True)
def do_append(input_m3u, video):
    append_video(input_m3u, video)

@click.command('insert', short_help='Update m3u by inserting video at specified index (0 for start).')
@click.argument('input_m3u', required=True)
@click.argument('video', required=True)
@click.argument('index', required=True)
def do_insert(input_m3u, video, index):
    insert_video(input_m3u, video, index)

@click.command('delete', short_help='Update m3u by deleting video at specified index.')
@click.argument('input_m3u', required=True)
@click.argument('index', required=True)
def do_delete(input_m3u, index):
    delete_video(input_m3u, index)

@click.command('get', short_help='Print video at specified index.')
@click.argument('input_m3u', required=True)
@click.argument('index', required=True)
def do_get(input_m3u, index):
    get_video(input_m3u, index)

@click.command('summary', short_help='Print summary of m3u, with titles and durations.')
@click.argument('input_m3u', required=True)
def do_summary(input_m3u):
    get_summary(input_m3u)


cli.add_command(do_curate)
cli.add_command(do_analyze)
cli.add_command(do_mesh)
cli.add_command(do_decide)
cli.add_command(do_regularize)
cli.add_command(do_gather)
cli.add_command(do_tag)
cli.add_command(do_repeat)
cli.add_command(do_append)
cli.add_command(do_insert)
cli.add_command(do_delete)
cli.add_command(do_get)
cli.add_command(do_summary)

if __name__ == '__main__':
    from m3u_manage.__meta__ import __version__
    print("m3u-manage {}\n".format(__version__))
    cli()
